<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Costos & Inventario</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- Auth Screen -->
    <div id="auth-screen" class="auth-container">
        <div class="auth-blobs">
            <div class="blob blob-1"></div>
            <div class="blob blob-2"></div>
            <div class="blob blob-3"></div>
        </div>
        
        <div class="auth-card glass-panel">
            <div class="auth-logo">
               <img src="images/logo.png" alt="Bonitas Creaciones" class="logo">
            </div>

            <!-- Login Form -->
            <form id="login-form" class="auth-form">
                <h2>Iniciar Sesi√≥n</h2>
                <div class="form-group">
                    <label>Usuario o Email</label>
                    <input type="text" id="login-username" required placeholder="Tu usuario o email" autocomplete="username">
                </div>
                <div class="form-group">
                    <label>Contrase√±a</label>
                    <input type="password" id="login-password" required placeholder="Tu contrase√±a" autocomplete="current-password">
                </div>
                <button type="submit" class="action-btn primary full-width">Entrar</button>
                <p class="auth-toggle">¬øNo tienes cuenta? <a href="#" id="show-register">Reg√≠strate aqu√≠</a></p>
            </form>

            <!-- Register Form -->
            <form id="register-form" class="auth-form hidden">
                <h2>Crear Cuenta</h2>
                <div class="form-group">
                    <label>Nombre Completo</label>
                    <input type="text" id="register-name" required placeholder="Tu nombre">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="register-email" required placeholder="tu@email.com">
                </div>
                <div class="form-group">
                    <label>Usuario</label>
                    <input type="text" id="register-username" required placeholder="Elige un nombre de usuario" autocomplete="username">
                </div>
                <div class="form-group">
                    <label>Contrase√±a</label>
                    <input type="password" id="register-password" required placeholder="M√≠nimo 6 caracteres" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label>Confirmar Contrase√±a</label>
                    <input type="password" id="register-password-confirm" required placeholder="Confirma tu contrase√±a" autocomplete="new-password">
                </div>
                <button type="submit" class="action-btn primary full-width">Crear Cuenta</button>
                <p class="auth-toggle">¬øYa tienes cuenta? <a href="#" id="show-login">Inicia sesi√≥n aqu√≠</a></p>
            </form>
        </div>
    </div>

    <div class="background-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <div class="app-container">
        <header class="glass-panel">
            <div class="header-brand">
                <img src="images/logo.png" alt="Bonitas Creaciones" class="logo">
                <div class="brand-text">
                    <h1>Calculadora de Costos</h1>
                    <span class="accent-text">Bonitas Creaciones</span>
                </div>
            </div>
            <nav>
                <button class="nav-btn active" data-target="dashboard">Dashboard</button>
                <button class="nav-btn" data-target="materials">Materiales</button>
                <button class="nav-btn" data-target="products">Productos</button>
                <button class="nav-btn logout-btn" id="btn-logout" title="Cerrar Sesi√≥n">üö™ Salir</button>
            </nav>
        </header>

        <main>
            <!-- Dashboard View -->
            <section id="dashboard" class="view active">
                <!-- Resumen General -->
                <div class="dashboard-section">
                    <div class="glass-panel">
                        <h2 class="section-title">Resumen General</h2>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">Productos</span>
                                <span class="stat-value" id="total-products-count">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Ventas Totales</span>
                                <span class="stat-value success" id="total-sales">$0.00</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Costos Totales</span>
                                <span class="stat-value" id="total-costs">$0.00</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Ganancia Neta</span>
                                <span class="stat-value success" id="total-profit">$0.00</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Materiales Bajos</span>
                                <span class="stat-value warning" id="low-stock-count">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="low-stock-alert"></div>

                <!-- Materiales con Stock Bajo -->
                <div class="dashboard-section">
                    <div class="glass-panel">
                        <h3 class="section-title">Materiales con Stock Bajo</h3>
                        <ul class="stock-list" id="low-stock-list">
                            <!-- Populated by JS -->
                        </ul>
                    </div>
                </div>

                <!-- Materiales M√°s Consumidos -->
                <div class="dashboard-section">
                    <div class="glass-panel">
                        <h3 class="section-title">Materiales M√°s Consumidos</h3>
                        <ul class="stock-list" id="top-consumed-list">
                            <!-- Populated by JS -->
                        </ul>
                    </div>
                </div>

                <!-- Gesti√≥n de Datos -->
                <div class="dashboard-section">
                    <div class="glass-panel">
                        <h3 class="section-title">Gesti√≥n de Datos</h3>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 16px;">
                            <button id="btn-export-data" class="action-btn secondary">Exportar Datos</button>
                            <button id="btn-bulk-calculator" class="action-btn primary">Pedidos Grandes</button>
                            <button id="btn-reset-history" class="action-btn danger">Reiniciar Historial</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Materials View -->
            <section id="materials" class="view hidden">
                <div class="glass-panel">
                    <div class="section-header">
                        <h2>Mis Materiales</h2>
                        <div style="display: flex; gap: 12px; align-items: center; flex: 1; justify-content: flex-end;">
                            <input type="text" id="search-materials" placeholder="Buscar materiales..."
                                style="max-width: 300px;">
                            <select id="filter-material-category" style="max-width: 200px;">
                                <option value="all">Todas las categor√≠as</option>
                                <option value="Telas">Telas</option>
                                <option value="Cierres">Cierres</option>
                                <option value="Forros">Forros</option>
                                <option value="Accesorios">Accesorios</option>
                                <option value="Hilos">Hilos</option>
                                <option value="Relleno">Relleno</option>
                                <option value="Otros">Otros</option>
                            </select>
                            <button id="btn-add-material" class="action-btn primary">+ Nuevo Material</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Categor√≠a</th>
                                    <th>Unidad</th>
                                    <th>Costo</th>
                                    <th>Stock</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="materials-list">
                                <!-- Material rows will be injected here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Products View -->
            <section id="products" class="view hidden">
                <div class="glass-panel">
                    <div class="section-header">
                        <h2>Mis Productos</h2>
                        <div style="display: flex; gap: 12px; align-items: center; flex: 1; justify-content: flex-end;">
                            <input type="text" id="search-products" placeholder="Buscar productos..."
                                style="max-width: 300px;">
                            <select id="filter-product-category" style="max-width: 200px;">
                                <option value="all">Todas las categor√≠as</option>
                                <option value="Cartucheras">Cartucheras</option>
                                <option value="Neceseres">Neceseres</option>
                                <option value="Mochilas">Mochilas</option>
                                <option value="Porta Cosm√©ticos">Porta Cosm√©ticos</option>
                                <option value="General">General</option>
                            </select>
                            <button id="btn-view-gallery" class="action-btn secondary">üì∏ Galer√≠a</button>
                            <button id="btn-add-product" class="action-btn primary">+ Nuevo Producto</button>
                        </div>
                    </div>
                    <div class="products-grid" id="products-list">
                        <!-- Product cards will be injected here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div id="modal-material" class="modal hidden">
        <div class="modal-content glass-panel">
            <span class="close-modal">&times;</span>
            <h2 id="modal-material-title">Nuevo Material</h2>
            <form id="form-material">
                <input type="hidden" id="material-id">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre</label>
                        <input type="text" id="material-name" required placeholder="Ej. Cordura...">
                    </div>
                    <div class="form-group">
                        <label>Categor√≠a</label>
                        <select id="material-category">
                            <option value="Telas">Telas</option>
                            <option value="Hilos">Hilos</option>
                            <option value="Cordura">Cordura</option>
                            <option value="Cierres">Cierres</option>
                            <option value="Forros">Forros</option>
                            <option value="Accesorios">Accesorios</option>
                            <option value="Otros">Otros</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Unidad de Medida</label>
                        <select id="material-unit">
                            <option value="m">Metros (m)</option>
                            <option value="cm">Cent√≠metros (cm)</option>
                            <option value="m2">Metros Cuadrados (m¬≤)</option>
                            <option value="cm2">Cent√≠metros Cuadrados (cm¬≤)</option>
                            <option value="u">Unidades (u)</option>
                            <option value="kg">Kilogramos (kg)</option>
                            <option value="g">Gramos (g)</option>
                            <option value="rollo">Rollos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Factor de Conversi√≥n (opcional)</label>
                        <input type="number" id="material-conversion" step="0.01" placeholder="Ej: 1 rollo = 50m">
                        <small style="color: var(--text-muted); font-size: 0.8rem;">Si 1 rollo = 50m, ingresa 50</small>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Costo por Unidad ($)</label>
                        <input type="number" id="material-cost" step="0.01" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Stock Inicial</label>
                        <input type="number" id="material-stock" step="0.01" required placeholder="0.00">
                    </div>
                </div>
                <button type="submit" class="action-btn primary full-width">Guardar Material</button>
            </form>
        </div>
    </div>

    <div id="modal-product" class="modal hidden">
        <div class="modal-content glass-panel large">
            <span class="close-modal">&times;</span>
            <h2 id="modal-product-title">Nuevo Producto</h2>
            <form id="form-product">
                <input type="hidden" id="product-id">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre del Producto</label>
                        <input type="text" id="product-name" required placeholder="Ej. Cartuchera Escolar">
                    </div>
                    <div class="form-group">
                        <label>Categor√≠a</label>
                        <select id="product-category">
                            <option value="Cartucheras">Cartucheras</option>
                            <option value="Neceseres">Neceseres</option>
                            <option value="Mochilas">Mochilas</option>
                            <option value="Porta Cosm√©ticos">Porta Cosm√©ticos</option>
                            <option value="General">General</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Imagen del Producto</label>
                    <input type="file" id="product-image" accept="image/*">
                    <div id="image-preview" style="margin-top: 10px; display: none;">
                        <img id="preview-img"
                            style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid var(--glass-border);">
                        <button type="button" id="btn-remove-image" class="action-btn danger"
                            style="margin-top: 8px; padding: 4px 12px; font-size: 0.85rem;">Eliminar Imagen</button>
                    </div>
                    <small style="color: var(--text-muted); font-size: 0.8rem;">Formatos: JPG, PNG, WebP (m√°x.
                        2MB)</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Margen de Ganancia Deseado (%)</label>
                        <input type="number" id="product-margin" step="1" min="0" placeholder="Ej. 50" value="50">
                        <small style="color: var(--text-muted); font-size: 0.8rem;">Se calcula si editas el
                            precio</small>
                    </div>
                    <div class="form-group">
                        <label>Precio de Venta ($)</label>
                        <input type="number" id="product-price" step="0.01" placeholder="Se calcula autom√°ticamente">
                        <small style="color: var(--text-muted); font-size: 0.8rem;">Editable - el margen se
                            ajustar√°</small>
                    </div>
                </div>

                <h3>Materiales</h3>
                <div class="recipe-builder">
                    <div class="form-row">
                        <select id="recipe-material-select">
                            <option value="">Seleccionar Material...</option>
                        </select>
                        <input type="number" id="recipe-quantity" placeholder="Cantidad" step="0.01">
                        <button type="button" id="btn-add-ingredient" class="action-btn secondary">Agregar</button>
                    </div>
                    <ul id="recipe-list" class="recipe-list">
                        <!-- Ingredients list -->
                    </ul>
                    <div class="cost-summary">
                        <span>Costo Total: <strong id="product-total-cost">$0.00</strong></span>
                    </div>
                </div>

                <button type="submit" class="action-btn primary full-width">Guardar Producto</button>
            </form>
        </div>
    </div>

    <!-- Bulk Order Calculator Modal -->
    <div id="modal-bulk" class="modal hidden">
        <div class="modal-content glass-panel large">
            <span class="close-modal">&times;</span>
            <h2>Calculadora de Pedidos Grandes</h2>
            <div class="form-group">
                <label>Selecciona el Producto</label>
                <select id="bulk-product">
                    <option value="">Seleccionar producto...</option>
                </select>
            </div>
            <div class="form-group">
                <label>Cantidad a Producir</label>
                <input type="number" id="bulk-quantity" min="1" value="1" placeholder="Ej: 50">
            </div>
            <button id="btn-calculate-bulk" class="action-btn primary">Calcular Materiales</button>
            <div id="bulk-results" style="margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Export Data Modal -->
    <div id="modal-export" class="modal hidden">
        <div class="modal-content glass-panel">
            <span class="close-modal">&times;</span>
            <h2>Exportar Datos</h2>
            <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 20px;">
                <button id="btn-export-materials" class="action-btn secondary">üì¶ Exportar Materiales (CSV)</button>
                <button id="btn-export-products" class="action-btn secondary">üéí Exportar Productos (CSV)</button>
                <button id="btn-export-history" class="action-btn secondary">üìä Exportar Historial (CSV)</button>
                <button id="btn-export-all" class="action-btn primary">üíæ Exportar Todo (JSON)</button>
            </div>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div id="modal-gallery" class="modal hidden">
        <div class="modal-content glass-panel large">
            <span class="close-modal">&times;</span>
            <h2>üì∏ Galer√≠a de Productos</h2>
            <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                <button id="btn-share-catalog" class="action-btn primary">üì§ Compartir Cat√°logo</button>
                <button id="btn-print-catalog" class="action-btn secondary">üñ®Ô∏è Imprimir Cat√°logo</button>
            </div>
            <div id="gallery-grid" class="gallery-grid">
                <!-- Product images will be injected here -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="modal-settings" class="modal hidden">
        <div class="modal-content glass-panel">
            <span class="close-modal">&times;</span>
            <h2>Configuraci√≥n de Base de Datos</h2>
            <p style="margin-bottom: 15px; color: var(--text-muted);">Conecta tu aplicaci√≥n a Supabase para guardar los
                datos en la nube.</p>

            <form id="form-settings">
                <div class="form-group">
                    <label>Supabase URL</label>
                    <input type="text" id="supabase-url" placeholder="https://xyz.supabase.co">
                </div>
                <div class="form-group">
                    <label>Supabase Anon Key</label>
                    <input type="password" id="supabase-key" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." autocomplete="off">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="action-btn primary full-width">Guardar y Conectar</button>
                    <button type="button" id="btn-disconnect" class="action-btn danger">Desconectar</button>
                </div>
            </form>

            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--glass-border);">
                <h3>Instrucciones</h3>
                <ol style="padding-left: 20px; color: var(--text-muted); font-size: 0.9rem; line-height: 1.6;">
                    <li>Crea una cuenta en <a href="https://supabase.com" target="_blank"
                            style="color: var(--primary);">supabase.com</a></li>
                    <li>Crea un nuevo proyecto.</li>
                    <li>Ve al "SQL Editor" y ejecuta el script que te he proporcionado (supabase_schema.sql).</li>
                    <li>Ve a "Project Settings" > "API" y copia la URL y la Anon Key aqu√≠.</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
</body>

</html>